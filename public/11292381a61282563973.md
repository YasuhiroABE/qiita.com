---
title: ç§çš„ã«æ—¥è‹±ç¿»è¨³APIã‚’åˆ©ç”¨ã—ã¦ã€å€‹äººè¾æ›¸ã‚’ä½œã£ã¦ã¿ãŸ
tags:
  - API
  - translation
private: false
updated_at: '2023-04-05T10:28:42+09:00'
id: 11292381a61282563973
organization_url_name: null
slide: false
ignorePublish: false
---
# ã¯ã˜ã‚ã«

çµ„ç¹”å†…ã§ã®æ—¥æœ¬èªæ–‡æ›¸ã‚’æ©Ÿæ¢°çš„ã«ç¿»è¨³ã—ã€ãã®çµæœã‚’è“„ç©ã™ã‚‹è¾æ›¸ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç›®æ¨™ã«è©¦ä½œã—ãŸæ™‚ã®ãƒ­ã‚°ã§ã™ã€‚

ä»Šå›ã¯åŸºæœ¬çš„ã«å›ºæœ‰åç§°ã‚„éƒ¨åˆ†çš„ãªã‚»ãƒ³ãƒ†ãƒ³ã‚¹ã®ç¿»è¨³ãƒ»è“„ç©ã«ç‰¹åŒ–ã—ã¤ã¤ã€å¤§æ ã‚’ä½œã‚‹ãŸã‚ã®æœ€åˆã®ã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã—ã¦ã„ãã¾ã™ã€‚

çµæœã¨ã—ã¦ã€ã“ã“ã§ç´¹ä»‹ã™ã‚‹ã‚¢ãƒ—ãƒªã¯æœ€åˆã«æç¤ºã—ãŸã‚ˆã†ãªæ©Ÿèƒ½ã‚’ãƒ•ãƒ«ã«å®Ÿè£…ã—ã¦ã„ã¾ã›ã‚“ã€‚DeepL APIã¨Google Cloud Translationã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹Ruby/Sinatra + Vue(v2)ã‚’åˆ©ç”¨ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

Microsoft Translatorã«ã¤ã„ã¦ã¯ã€ã“ã“ã§ã¯è§¦ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€ã“ã®è¨˜äº‹ã®ç¶šç·¨ã¨ã—ã¦å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

* [Microsoft Translator APIã‚’ä½¿ã£ã¦ã¿ãŸ](https://qiita.com/YasuhiroABE/items/a68d8b50f50389992229)

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®è€ƒæ…®ç‚¹

APIã‚’åˆ©ç”¨ã™ã‚‹ä¸Šã§ã¯Credential(èªè¨¼æƒ…å ±)ã‚’ä¿å­˜ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚„æ–‡å­—åˆ—ãªã©ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã«å«ã‚ã¦é…å¸ƒã—ã¦ã—ã¾ã†ã‚±ãƒ¼ã‚¹ãŒåº¦ã€…å•é¡Œã«ãªã‚Šã¾ã™ã€‚

ä»Šå›ã¯è‡ªåˆ†ã ã‘ãŒåˆ©ç”¨ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ãŒã€JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚„APIã‚­ãƒ¼ã¯ç’°å¢ƒå¤‰æ•°(GOOGLE_APPLICATION_CREDENTIALSã€GOOGLE_PROJECT_IDã€DEEPL_AUTH_KEYç­‰)ã‚’åˆ©ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ã¯ç‹¬ç«‹ã•ã›ã¦ã„ã¾ã™ã€‚

ãã‚Œãã‚Œã‚‚è‡ªåˆ†è‡ªèº«ã«å›ºæœ‰ãªCredentialã‚’Dockerfileã‚„Makefileãªã©ã«å«ã‚ã¦ã€GitHubã§å…¬é–‹ã™ã‚‹ã“ã¨ãªã©ãŒãªã„ã‚ˆã†ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

# ä»Šå›èª¬æ˜ã™ã‚‹å†…å®¹ã®å®Œæˆå“

ä½œæˆã™ã‚‹éç¨‹ã‚’ãƒ¡ãƒ¢ã—ã¦ã„ã¾ã™ãŒã€å®Œæˆã—ãŸã‚‚ã®ã¯æ¬¡ã®ãƒªãƒ³ã‚¯å…ˆã«é…ç½®ã—ã¦ã„ã¾ã™ã€‚å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æœ€å¾Œã§ä½¿ã„æ–¹ãªã©ã¯èª¬æ˜ã—ã¦ã¾ã™ã€‚

* [GitHub - YasuhiroABE/docker-example-transapi](https://github.com/YasuhiroABE/docker-example-transapi)
* [docker.io/yasuhiroabe/example-transapi](https://hub.docker.com/repository/docker/yasuhiroabe/example-transapi)
* [GitHub - YasuhiroABE/docker-transapi-frontend](https://github.com/YasuhiroABE/docker-transapi-frontend)

ãªãŠ Microsoft Translatorã«ã¤ã„ã¦ã¯åˆ¥è¨˜äº‹ã§è§£èª¬ã—ã¦ã„ã¾ã™ãŒã€ç¾åœ¨ã®doocker-example-traansa (tag:v1.0.0) ã«ã¯ã€Microsoft Translatorã®ã‚³ãƒ¼ãƒ‰ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

ã‚‚ã—DeepLã ã‘ã‚’å‹•ã‹ã™ã¨ã„ã£ãŸå ´åˆã«ã¯ã€default_api.rb ã‚’å¤‰æ›´ã—ã¦ã€gct.rbç­‰ã®ã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã•ãªã„ã‚ˆã†ã«ã™ã‚‹ã ã‘ã§å‹•ä½œã™ã‚‹ã¯ãšã§ã™ã€‚

# åˆ©ç”¨ã™ã‚‹å€™è£œã¨ãªã‚‹ã‚µãƒ¼ãƒ“ã‚¹

ã„ãã¤ã‹åˆ©ç”¨å¯èƒ½ãªå€™è£œã‚’å‡ºã—ã¦ã¿ã¾ã™ã€‚

* [Google Translation API](https://cloud.google.com/translate?hl=ja) (Google Cloud Translation, GCT)
* [Microsoft Translator](https://azure.microsoft.com/ja-jp/services/cognitive-services/translator/)
* [DeepL API](https://www.deepl.com/pro#developer)

ã“ã®è¨˜äº‹ã®ä¸­ã§ã¯ã€Microsoft Translatorã¯åˆ©ç”¨ã—ã¦ã„ã¾ã›ã‚“ãŒã€æœ€æ–°ç‰ˆã®GitHubã®mainãƒ–ãƒ©ãƒ³ãƒã«ã¯ã€Microsoft Translatorã‚’åˆ©ç”¨ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚‚è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

## ãã‚Œãã‚Œã®ã‚µãƒ¼ãƒ“ã‚¹ã®ç‰¹å¾´

Google (Cloud) Translation API (GCT)ã¯å˜ç´”ãªç¿»è¨³ã‚µãƒ¼ãƒ“ã‚¹ã¨ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®ç¿»è¨³æƒ…å ±ã‚’è“„ç©ãƒ»å­¦ç¿’ã•ã›ã‚‹AIã‚’ä¾›ãˆãŸã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã™ã‚‹ãªã©ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‹ãƒ¼ã‚ºã«åˆã‚ã›ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

èª²é‡‘å¯¾è±¡ã¯50ä¸‡æ–‡å­—/æœˆã¾ã§ã¯ç„¡æ–™ã§ã€åŸºæœ¬çš„ã«ã¯è¨€èªåˆ¤å®šã«ä½¿ç”¨ã—ãŸæ–‡å­—æ•°ã¨ã€ãã®æ¬¡ã®ç¿»è¨³ã«ä½¿ç”¨ã—ãŸæ–‡å­—æ•°ã®ä¸¡æ–¹ãŒåˆç®—ã•ã‚Œã‚‹ãŸã‚ã€å˜ç´”ãªæ–‡å­—æ•°ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãŸç©ºã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯1æ–‡å­—åˆ†ã€ç©ºç™½æ–‡å­—ã‚„ã‚¿ã‚°ãªã©ã®è£…é£¾æ–‡å­—ã‚‚ã€APIã«ä¸ãˆãŸæ–‡å­—æ•°ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹ã“ã¨ã«ãªã£ã¦ã„ã¾ã™ã€‚

ç„¡æ–™åˆ†ã‚’è¶…éã™ã‚‹ã¨ã€100ä¸‡æ–‡å­—ã‚ãŸã‚Š20ãƒ‰ãƒ«ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚ã“ã®ä»–ã«1000ãƒšã‚¢æœªæº€ã®è¾æ›¸ã‚’ä¸ãˆã¦AIæ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«9000ã€œ13500å††ç¨‹åº¦è¿½åŠ ã§å¿…è¦ã¨ãªã‚Šã€å¾Œã¯ç¿»è¨³ã®éƒ½åº¦ã€é€šå¸¸ã®æ–™é‡‘ä½“ç³»ãŒé©ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚

Microsoft Translatorã¯200ä¸‡æ–‡å­—/æœˆã¯ç„¡æ–™ã§ã€100ä¸‡æ–‡å­—æ¯ã«1120å††ãŒã‹ã‹ã‚Šã¾ã™ã€‚ãŸã æ–™é‡‘ä½“ç³»ã¯å°‘ã—ä¸æ˜ç­ã§ã€ä½¿ç”¨ã™ã‚‹æ©Ÿèƒ½æ¯ã«å˜ä¾¡ãŒç•°ãªã‚‹ã‚ˆã†ã§ã™ã€‚

DeepL API (DeepL)ã¯630å††/æœˆã®å›ºå®šæ–™é‡‘ã®ä»–ã«ã€100ä¸‡æ–‡å­—ã‚ãŸã‚Š2500å††ã¨ã„ã†ã‚·ãƒ³ãƒ—ãƒ«ãªè¨­å®šã«ãªã£ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã¾ã§DeepL Proã®å€‹äººç‰ˆã‚’åˆ©ç”¨ã—ã¦ã„ã¦ã€Google Cloud Platformã§ã¯AppEngineã‚„GKEã‚’åˆ©ç”¨ã—ã¦ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æƒ…å ±ãªã©ã¯ç™»éŒ²ã—ã¦ã„ã‚‹ã®ã§ã€ä»Šå›ã¯DeepLã¨Googleã®2ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

# ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã®ä½œæˆ

å˜ç´”ãªWeb APIã‚’OpenAPIã§è€ƒãˆã¦ã€å®Ÿè£…ã¯Ruby/Sinatraã§ä½œæˆã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

1. åŒã˜å˜èªã‚’ç¹°ã‚Šè¿”ã—APIã«é€ä¿¡ã™ã‚‹ã“ã¨ãŒãªã„ã‚ˆã†ã«ç®¡ç†ã™ã‚‹ã“ã¨
2. æ—¥â†’è‹±ã®ç¿»è¨³ã®ã¿ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨
3. ä»»æ„ã®æ—¥ãƒ»è‹±ã®ãƒšã‚¢ã‚’æ‰‹å‹•ã§ç™»éŒ²ã§ãã‚‹ã“ã¨
4. é–“é•ã„ãªã©ä¸é©åˆ‡ãªæƒ…å ±ã‚’å‰Šé™¤ã§ãã‚‹ã“ã¨
5. DeppL APIã¨Google Translation APIã®2ã¤ã®çµæœã‚’ä¿å­˜ã™ã‚‹ã“ã¨

1ãƒšãƒ¼ã‚¸ã«åã¾ã‚Šãã†ãªä»•æ§˜ã«ãªã‚Šãã†ã§ã™ã€‚

## ç”»é¢ã‚¤ãƒ¡ãƒ¼ã‚¸

å®Ÿè£…ã¯node.jsã‚„HTML5ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ãŒã€ã¾ã æ±ºã‚ã¦ã„ã¾ã›ã‚“ã€‚

ç”»é¢ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã ã„ãŸã„ã“ã‚“ãªæ„Ÿã˜ã‹ãªã¨æ€ã„ã¾ã™ã€‚
æ—¥æœ¬èªå…¥åŠ›çª“ã«æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œã‚‹åº¦ã«å†…éƒ¨DBã«æ—¢å­˜ã®æ¤œç´¢çµæœãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã€
è©²å½“ã™ã‚‹æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

```text:ç”»é¢ã‚¤ãƒ¡ãƒ¼ã‚¸
+--------------+   +--------------+  +--------------+
|  æ—¥æœ¬èªå…¥åŠ›çª“  | â†’ | è‹±èªå…¥å‡ºåŠ›ç”¨çª“ |  | æ‰‹å‹•ç™»éŒ²ãƒœã‚¿ãƒ³ |
+--------------+   +--------------+  +--------------+
+--------------+  +-------------+
| ç¿»è¨³é–‹å§‹ãƒœã‚¿ãƒ³ |  | å†æ¤œç´¢ãƒã‚§ãƒƒã‚¯ | (â† ãƒã‚§ãƒƒã‚¯ã‚’ã™ã‚‹ã¨å†åº¦æ¤œç´¢APIã«å•ã„åˆã‚ã›ã€èª²é‡‘ãŒç™ºç”Ÿ)
+--------------+  +-------------+
(â†‘ æ¤œç´¢çµæœãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯æŠ¼ã›ãªã„ã‚ˆã†ã«ã™ã‚‹) 

ã€æ¤œç´¢çµæœ (éåŒæœŸè¡¨ç¤º)ã€‘
+----------------------------------+------------+
| No | æ—¥æœ¬èª |  è‹±èª | DeepL/Google | æ¤œç´¢æ—¥      |
+----------------------------------+------------+
| 1. | è¦ã€€   | method      | D&G   |  2020/11/1 |
| 2. | è¦å®š   | regulations | D     |  2020/11/4 | ç™»éŒ²ãƒœã‚¿ãƒ³ |
| 3. | è¦å®š   | rules       | G     |  2020/11/4 |
```

ã“ã‚Œãã‚‰ã„ã ã¨ç¿»è¨³APIã‚’å©ã‹ãªãã¦ã‚‚æ‰‹å‹•ç™»éŒ²ã ã‘ã§è‰¯ã„ã§ã—ã‚‡ã†ã¨ã„ã†æ„Ÿã˜ã§ã™ãŒã€ã¾ãã¨ã‚Šã‚ãˆãšç¿»è¨³APIæ©Ÿèƒ½ã‚’ã“ã‚Œã‹ã‚‰åˆ©ç”¨ã—ã¦ã„ãéœ²æ‰•ã„ã ã¨æ€ã£ã¦ä½œã£ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

## APIã®ä»•æ§˜

æ…£ã‚Œã¦ã„ã‚‹OpenAPIã‚’ä½¿ç”¨ã—ã¦ã€openapi-generatorã§ruby/sinatraã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã¨ã‚Šã‚ãˆãšç”»é¢ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å……è¶³ã•ã›ã‚‹ãŸã‚ã€æ¬¡ã®ã‚ˆã†ãªAPIã‚’æº–å‚™ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

/dictã§å†…éƒ¨DBã¸ã®å•ã„åˆã‚ã›ã€/transã§èª²é‡‘ãŒç™ºç”Ÿã™ã‚‹DeepLã¨GCTã¸ã®å•ã„åˆã‚ã›ã‚’è¡Œãªã†ã“ã¨ã¨ã—ã¾ã™ã€‚

* GET /dict?q=æ—¥æœ¬èª
* PUT /dict?ja=æ—¥æœ¬èª&en=English
* GET /trans?q=æ—¥æœ¬èª

ä»Šå›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ä»¥å‰ä½œæˆã—ãŸopenapi ruby/sinatraã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ãƒ™ãƒ¼ã‚¹ã«ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

* https://github.com/YasuhiroABE/docker-sccp-sinatra-sample

å…·ä½“çš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹å‰ã«ã€å„APIã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚

## DeepL APIã‚’è©¦ã™

* [DeepL APIã‚¬ã‚¤ãƒ‰](https://www.deepl.com/docs-api/accessing-the-api/)

å˜ç´”ãªWebã‚¯ã‚¨ãƒªã«auth_keyãªã©ã‚’ã‚»ãƒƒãƒˆã™ã‚Œã°è‰¯ã„ã®ã§ã€ã“ã‚Œã«ã¤ã„ã¦ç‰¹ã«è¨˜è¿°ã¯ã—ã¾ã›ã‚“ã€‚
ãŸã å®Ÿéš›ã«åˆ©ç”¨ã™ã‚‹ã¨ã€æ—¥æœ¬èªã®å˜èªã‚’ä¸­å›½èªã¨åˆ¤æ–­ã™ã‚‹å ´åˆãŒã‚ã‚‹ã®ã§ã€source_languageã¯å¸¸ã«æŒ‡å®šã™ã‚‹ã®ãŒãŠå‹§ã‚ã§ã™ã€‚

## Google Translation APIã‚’è©¦ã™

* [Google Translation APIã‚¬ã‚¤ãƒ‰](https://cloud.google.com/translate/docs/setup?hl=ja#ruby)
* [ãƒ†ã‚­ã‚¹ãƒˆã®ç¿»è¨³(Basic)](https://cloud.google.com/translate/docs/basic/quickstart?hl=ja)

ã‚¬ã‚¤ãƒ‰ã«ã‚ˆã‚Œã°Rubyã‹ã‚‰Google Translation APIã‚’å‘¼ã³å‡ºã™ãŸã‚ã«ã¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å°å…¥ãŒå¿…è¦ã§ã™ã€‚
ã¾ãŸå¹³è¡Œã—ã¦**gcloud**ã‚³ãƒãƒ³ãƒ‰ã‚‚æº–å‚™ã™ã‚‹ã‚ˆã†æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

```bash:gcloudã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹åˆæœŸåŒ–
$ curl -O https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-315.0.0-linux-x86_64.tar.gz
$ tar xvzf google-cloud-sdk-315.0.0-linux-x86_64.tar.gz
$ cd google-cloud-sdk
$ ./install.sh
$ ./bin/gcloud init
$ export GOOGLE_APPLICATION_CREDENTIALS=/home/......./xxxx-xxxxxxxxx.json ## Cloud Consoleã§ä½œæˆã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹
$ gcloud auth application-default print-access-token
```

Rubyã‹ã‚‰å‘¼ã³å‡ºã™ãŸã‚ã«bundleã‚’ä½¿ç”¨ã—ã¦å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æº–å‚™ãªã©ã‚’é€²ã‚ã‚‹ã€‚

```text:Gemfile
source 'https://rubygems.org'
gem "google-cloud-translate"
```

```bash:rubyãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
$ bundle config set path lib
$ bundle install
...
$ ls -F
Gemfile  Gemfile.lock  lib/
```

### ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®å®Ÿè£…

Gemfileãªã©ã‚’é…ç½®ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«example.rbã‚’é…ç½®ã—ã¾ã™ã€‚
GCTã®ã‚¬ã‚¤ãƒ‰ã«ã‚ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã«project_idãªã©ã‚’è¨­å®šã™ã‚‹ä»–ã«ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®è¨­å®šã‚’åŠ ãˆã¾ã™ã€‚

```ruby:example.rb
#!/usr/bin/ruby

project_id    = "Your Google Cloud project ID"
text          = "The text you would like to translate."
language_code = "ja"

ENV['GOOGLE_APPLICATION_CREDENTIALS'] = "/home/.../xxxx-xxxxxxxxx.json"
require 'bundler/setup'
Bundler.require

translate   = Google::Cloud::Translate.translation_v2_service project_id: project_id
translation = translate.translate text, to: language_code

puts "Translated '#{text}' to '#{translation.text.inspect}'"
puts "Original language: #{translation.from} translated to: #{translation.to}"
```

ã“ã®example.rbã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```bash:example.rbã®å®Ÿè¡Œä¾‹
$ bundle config set path lib
$ bundle install
$ ruby example.rb
Translated 'The text you would like to translate.' to '"ç¿»è¨³ã—ãŸã„ãƒ†ã‚­ã‚¹ãƒˆã€‚"'
Original language: en translated to: ja
```

ã¨ã‚Šã‚ãˆãšAPIã¯åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

# Web APIã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹

Web APIã®éƒ¨åˆ†ã¯ã€OpenAPIã‚’åˆ©ç”¨ã—ã¦ã€Ruby/Sinatraã§å®Ÿè£…ã—ã¾ã™ã€‚

## openapi.yamlãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™

ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’å±•é–‹ã—ã€å…ˆã»ã©ã®æƒ³å®šã—ãŸAPIã‚’å®šç¾©ã—ãŸopenapi.yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™ã—ã¾ã™ã€‚

```bash:
$ git clone https://github.com/YasuhiroABE/docker-sccp-sinatra-sample example-transapi
$ cd example-transapi
```

emacsã‚„viã§æ—¢ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹openapi.yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ã„ãã¾ã™ã€‚

```yaml:openapi.yaml
openapi: 3.0.3
info:
  title: Unified Translation API
  version: 1.0.0
  description: Simplified Intranet-Web Japanese to English Dictionary and Translation API
  contact:
    name: YasuhiroABE
    url: https://yadiary.net/
    email: yasu@yasundial.org
servers:
- url: http://localhost:8080
paths:
  /.spec:
    get:
      description: providing the openapi schema YAML file.
      responses:
        200:
          description: "200 response"
  /dict: 
    get:
      description: e.g. /dict?q=query-words
      parameters:
      - in: query
        name: q
        required: true
        schema:
          type: string
      responses:
        200:
          description: "200 response"
    post:
      description: e.g. /dict?ja=japanese-words&en=english-words
      parameters:
      - in: query
        name: ja
        required: true
        schema:
          type: string
      - in: query
        name: en
        required: true
        schema:
          type: string
      responses:
        200:
          description: "200 response"
  /trans: 
    get:
      description: e.g. /trnas?q=query-words
      parameters:
      - in: query
        name: q
        required: true
        schema:
          type: string
      responses:
        200:
          description: "200 response"
```

ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã«ã¯openapi-spec-validatorã‚’å‘¼ã³å‡ºã™taskãŒMakefileã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚
æœªå°å…¥ã§ã‚ã‚Œã°æ¬¡ã®æ‰‹é †ã§å°å…¥å¯èƒ½ã§ã™ã€‚pip3ã®ã‚³ãƒãƒ³ãƒ‰åã¯ç’°å¢ƒã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

```bash:Ubuntu20.04ã§openapi-spec-validatorã‚’~/.local/bin/ã«å°å…¥ã™ã‚‹
$ pip3 install openapi-spec-validator --user
```

ä½œæˆã—ãŸopenapi.yamlãŒæ­£ã—ã„ã‹ã©ã†ã‹ã€ç¢ºèªã—ã¾ã™ã€‚

```bash:validateã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹
$ make validate
/home/user01/.local/bin/openapi-spec-validator openapi.yaml
OK
```

## ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆ

æ­£ã—ã„openapi.yamlãŒä½œæˆã§ããŸã‚‰Ruby/Sinatraã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```bash:rubyã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆ
$ make gen-code
openapi-generator-cli generate -g ruby-sinatra -o code -i openapi.yaml
...
$ ls -F
api.default_api.rb  code/  _docker/  Makefile  openapi.yaml
## ä¸è¦ãªapi.default_api.rbã‚’å‰Šé™¤ã™ã‚‹ (ä»»æ„)
$ rm api.default_api.rb
```

ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚³ãƒ¼ãƒ‰ã¯ã€./codeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã“ã‹ã‚‰å…ˆã®ä½œæ¥­ã¯ã€./codeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦è¡Œã„ã¾ã™ã€‚

```bash:ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ç§»å‹•
$ cd code/
```

## Gemfileã®ç·¨é›†

Gemfileã‚’ç·¨é›†ã—ã¦ã€GCTãŒåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```text:code/Gemfile
source 'https://rubygems.org'
gem "puma"
gem "sinatra"
gem "sinatra-cross_origin"
gem "httpclient"
gem "google-cloud-translate"
gem "json"
gem "rsolr"
```

DeepL APIã®å‡¦ç†ã¯ã€ä½ãƒ¬ãƒ™ãƒ«ãªhttpclientã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
ä»Šå›ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«RDBMSã§ã¯ãªãã€Solrã‚’æ¤œè¨ã—ã¦ã„ã‚‹ãŸã‚ã€rsolr ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

## DeepL APIã¨Google Translation APIã‚’å‡¦ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆ

å¾Œã‹ã‚‰APIã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã€2ã¤ã®ã‚¯ãƒ©ã‚¹ã‚’åŒä¸€ã®åŸºåº•ã‚¯ãƒ©ã‚¹ã‹ã‚‰æ´¾ç”Ÿã•ã›ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚(ã¨ã¯ã„ãˆã€ã“ã®è¦æ¨¡ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã‚ã¾ã‚Šæ„å‘³ã¯ã‚ã‚Šã¾ã›ã‚“ãŒâ€¦)

```ruby:æŠ½è±¡ã‚¯ãƒ©ã‚¹DataAPIã®å®šç¾©(code/lib/dataapi.rb)
class DataAPI
  JA = "ja"
  EN = "en"
  def initialize
    raise "Nobody can create the instance of DataAPI class."
  end

  def trans(string, to_lang = DataAPI::EN)
    ret = { :original_text => string,
            :translate_text => "",
            :to_lang => to_lang }
    return ret
  end
end
```

ä¸€å¿œã€è‹±â†’æ—¥ã®å¯èƒ½æ€§ã‚‚æ®‹ã—ã¦ã„ã‚‹ã®ã¨ã€æ–‡å­—åˆ—ãŒ7bit ascii codeã®ç¯„å›²ã ã£ãŸã‚‰ç„¡æ¡ä»¶ã«è‹±â†’æ—¥ã¨ã„ã†æ–¹æ³•ã‚‚è€ƒãˆã‚‰ã‚Œã‚‹ã®ã§ã™ãŒã€ã¨ã‚Šã‚ãˆãšã“ã†ã„ã†å‹•ãã«ã—ã¦ãŠãã¾ã™ã€‚

```ruby:GoogleCloudTranslateã‚¯ãƒ©ã‚¹(code/lib/gct.rb)

require "google/cloud/translate"

class GoogleCloudTranslate < DataAPI
  def initialize
    @project_id  = ENV.has_key?('GOOGLE_PROJECT_ID') ? ENV['GOOGLE_PROJECT_ID'] : ""
  end

  def trans(string, to_lang: GoogleCloudTranslate::EN)
    ret = { :original_text => string,
            :translate_text => "",
            :to_lang => to_lang }
    translate   = Google::Cloud::Translate.translation_v2_service project_id: @project_id
    translation = translate.translate string, to: to_lang
    ret[:translate_text] = translation.text.inspect
    return ret
  end
end
```

```ruby:DeepLAPIã‚¯ãƒ©ã‚¹(code/lib/deeplapi.rb)
# coding: utf-8
require 'json'
require 'uri'
require 'httpclient'

class DeepLAPI < DataAPI
  DEEPL_TRANS_PATH = "/v2/translate"
  def initialize
    @deepl_host  = ENV.has_key?('DEEPL_HOST') ? ENV['DEEPL_HOST'] : ""
    @auth_key  = ENV.has_key?('DEEPL_AUTHKEY') ? ENV['DEEPL_AUTHKEY'] : ""
  end

  def query_api(query)
    ret = {}
    header = {
      "Authorization" => "DeepL-Auth-Key #{@auth_key}"
    }
    begin
      client = HTTPClient.new
      url = "https://#{@deepl_host}#{DEEPL_TRANS_PATH}"
      resp = client.post(url, query, header)
      ret = JSON.parse(resp.body)
    rescue
      puts "[error] query_api: failed to query: #{:host},#{:path},#{:query}."
      ret = {}
    end
    return ret
  end

  def query_trans(source, to_lang, src_lang)
    q = {
      :text => source,
      :target_lang => to_lang,
      :source_lang => src_lang
    }
    query_api(q)
  end

  def trans(string, to_lang: DeepLAPI::EN, src_lang: DeepLAPI::JA)
    s = CGI::unescapeHTML(string)
    ret = { :original_text => CGI::unescapeHTML(string),
            :translate_text => "",
            :to_lang => to_lang }
    trans_result =  query_trans(s, to_lang, src_lang)
    ret[:translate_text] = trans_result["translations"][0]["text"]
    return ret
  end
end
```

ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ lib ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ã¦ãŠãã¾ã™ã€‚

```bash:
$ ls lib

dataapi.rb  deeplapi.rb  gct.rb  openapiing.rb  ruby/
```

## Sinatraãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®š

### config.ruãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£

é…ç½®ã—ãŸrbãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«è¨­å®šã—ã¦ãŠãã¾ã™ã€‚

```ruby:code/config.ru
require 'bundler/setup'
Bundler.require
require './my_app'
run MyApp
```

config.ruãŒèª­ã¿è¾¼ã‚€my_app.rbãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã™ã‚‹æ‰‹æ®µã‚‚ã‚ã‚Šã¾ã™ãŒã€ãã¡ã‚‰ã«ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ãŒåŸ‹ã‚è¾¼ã¾ã‚Œã‚‹ã®ã§ã€openapi.yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’å†ç”Ÿæˆã™ã‚‹éƒ½åº¦ã€å†…å®¹ãŒå¤‰åŒ–ã™ã‚‹ã®ã§ã€å¤‰åŒ–ã—ãªã„config.ruãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜ã—ã¦ã„ã¾ã™ã€‚

### code/api/default_api.rbã®ä¿®æ­£

openapi-generatorãŒã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚³ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã™ã‚‹ã®ã§ã€å®Ÿéš›ã®å‡¦ç†ã‚’ã“ã“ã«è¨˜è¿°ã—ã¦ã„ãã¾ã™ã€‚
MyApp.add_route('GET', '/trans', ã‹ã‚‰å§‹ã¾ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰å†…éƒ¨ã«æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’åŠ ãˆã¦ã„ã¾ã™ã€‚

```ruby:code/api/default_api.rbã®ä¿®æ­£ç®‡æ‰€
  cross_origin
  param = {}
  param[:q] = params.has_key?(:q) ? Rack::Utils.escape_html(params[:q]) : ""

  ## prepare the data structure to be returned.
  ret = {
    :version => "1.0",
    :results => []
  }
  ## escape if query is empty.
  return ret.to_json if param[:q] == ""

  deepl = DeepLAPI.new
  gct = GoogleCloudTranslate.new
  for result in [["deepl", deepl.trans(param[:q])], ["gct", gct.trans(param[:q])]]
    MyUtil::add_data(result[0], ret[:results], result[1])
  end
  ret.to_json
```

ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å†…éƒ¨ã§æ¤œç´¢çµæœã‚’retå¤‰æ•°ã«æ ¼ç´ã™ã‚‹ãŸã‚ã«MyUtil.add_dataã‚’æº–å‚™ã—ã¦ã„ã¾ã™ã€‚
lib/myutil.rbã‚’é…ç½®ã—ã¦æ¬¡ã®ã‚ˆã†ãªå†…å®¹ã«ã—ã¦ã„ã¾ã™ã€‚

```ruby:code/lib/myutil.rb
class MyUtil
  def self.add_data(label, array, result)
    array.append({ :engine => label,
                   :original_text => result[:original_text],
                   :translate_text => result[:translate_text],
                   :to_lang => result[:to_lang]
                 })
    return array
  end
end
```

ã¨ã‚Šã‚ãˆãš /trans ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾å¿œã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã€ã“ã“ã§èª¬æ˜ã—ãŸã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’ãƒ™ãƒ¼ã‚¹ã«æ§‹ç¯‰ã—ã¦ã„ã¾ã™ã€‚

### /dict ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾å¿œã™ã‚‹å‡¦ç†

/dictã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯æ¤œç´¢çµæœã‚’ä¿æŒã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã¾ã™ã€‚
æœ€çµ‚çš„ã«k8sç’°å¢ƒã§ãƒ›ã‚¹ãƒˆã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ã€SQLiteã®ã‚ˆã†ãªãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã¯è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾å¿œã•ã›ã‚‹ã“ã¨ãŒé›£ã—ã„ã®ã§ã€ä»Šå›ã¯Solrã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦åˆ©ç”¨ã—ã¾ã™ã€‚

Solrã¯dockerã‚’åˆ©ç”¨ã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§åˆ©ç”¨ã—ã¾ã™ã€‚

## Solrã®è¨­å®š

ã“ã®ä½œæ¥­ã¯ã€code/ ã§ã¯ãªãã€docker-ruby-transapi/ ã§ä½œæ¥­ã—ã¦ãã ã•ã„ã€‚

ãƒ†ã‚¹ãƒˆç”¨ã®Solrã¯Dockerã‚’åˆ©ç”¨ã—ã¦ã€æ¬¡ã®URLã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
ã‚ã‚‰ã‹ã˜ã‚ var.solr/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æº–å‚™ã—ã¦ã„ã¾ã™ã€‚å…¬å¼Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®solr:8.7ã¯ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼(uid=8983)ã§å‹•ä½œã™ã‚‹ãŸã‚æ›¸ãè¾¼ã¿æ¨©é™ã‚’ä¸ãˆã¦ãŠãã¾ã™ã€‚

```bash:
$ mkdir -p var.solr
$ mkdir chmod 1777 var.solr
```

docker-ruby-transapi/Makefile ã«Solrã‚’èµ·å‹•ãƒ»åœæ­¢ã™ã‚‹ãŸã‚ã®ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```makefile:solrã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ã®ãŸã‚Makefileã«è¿½åŠ 
solr-run:
        sudo docker run -it --rm -d \
                -p 8983:8983 \
                -v `pwd`/var.solr:/var/solr \
                --name solr \
                solr:8.7

solr-stop:
	sudo docker stop solr
```

ä½œæ¥­ã®ãŸã‚ã€Solrã‚’èµ·å‹•ã—ã¾ã™ã€‚

```bash:solrã®èµ·å‹•
$ make solr-run
```

æ­£å¸¸ã«èµ·å‹•ã—ãŸã‚‰ã€solrã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦"solrbook" coreã‚’ä½œæˆã—ã¾ã™ã€‚
Web UIã‹ã‚‰ã®coreä½œæˆã¯å¤±æ•—ã™ã‚‹å ´åˆãŒã‚ã‚‹ã®ã§ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã®ä½œæˆãŒãŠå‹§ã‚ã§ã™ã€‚

```bash
$ sudo docker exec -it solr /opt/solr/bin/solr create_core -c solrbook
```

æˆåŠŸã™ã‚‹ã¨ã€æ¬¡ã®URLã§APIã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

* URL: http://127.0.0.1:8983/solr/solrbook

### ã€æ–¹æ³•1ã€‘filed-type, filedã®è¨­å®š

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯æ˜ç¤ºçš„ã«fieldã‚’æº–å‚™ã—ãªãã¦ã‚‚ã€æŒ‡å®šã—ãŸJSONå½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾ä¿å­˜ã—ã¦ãã‚Œã¾ã™ãŒã€æ—¥æœ¬èªã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹ãŸã‚ã«ã¯æ‰‹å‹•ã§field-typeã¨fieldã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒå‡ºã¦ãã¾ã™ã€‚

æ¬¡ã®ã‚ˆã†ãªå½¢å¼ã§field-typeã‚„fieldã®å®šç¾©ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§æº–å‚™ã—ã¦ãŠãã¾ã™ã€‚


```json:ft-text_ja_edgengram.json
{
  "field-type": {
    "name": "text_ja_edgengram",
    "class": "solr.TextField",
    "autoGeneratePhraseQueries": "true",
    "positionIncrementGap": "100",
    "analyzer": {
      "charFilter": [
        {
          "class": "solr.ICUNormalizer2CharFilterFactory"
        }
      ],
      "tokenizer": {
        "class": "solr.EdgeNGramTokenizerFactory",
        "minGramSize": "1",
        "maxGramSize": "1"
      },
      "filter": [
        {
          "class": "solr.CJKWidthFilterFactory",
          "class": "solr.LowerCaseFilterFactory"
        }
      ]
    }
  }
}
```

```json:f-content_edgengram.json
{
  "field" : {
    "name" : "content_edgengram",
    "type" : "text_ja_edgengram",
    "multiValued" : "true",
    "indexed" : "true",
    "required" : "true",
    "stored" : "true"
  }
}
```

ãƒ‡ãƒ¼ã‚¿ã¯"field-type"ã‹"field"ã„ãšã‚Œã‹1ã¤ã®keyã‚’æŒã¤æ§‹é€ ã«ãªã£ã¦ã„ã¾ã™ã€‚
è¿½åŠ ã™ã‚‹æ™‚ã«ã¯"add-field-type"ãªã©ã«å¤‰æ›ã—ã€å‰Šé™¤ã™ã‚‹æ™‚ã«ã¯ã€"delete-field-type"ã«å¤‰æ›ã—ãŸä¸Šã§ã€"name"ã ã‘ã‚’Keyã«æŒã¤æ§‹é€ ã‚’å–ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

æ‰‹å‹•ã§ä½œæ¥­ã™ã‚‹ã®ã¯é¢å€’ãªã®ã§ã€æ¬¡ã®ã‚ˆã†ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‡¦ç†ã‚’ã—ã¦ã„ã¾ã™ã€‚

```text:Gemfile
source 'https://rubygems.org'
gem "httpclient"
gem "json"
```

```$ bundle install --path lib``` ã§./lib/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å°å…¥ã—ã¦ãŠãã¾ã™ã€‚

```ruby:setup-solr-schema.rb
#!/usr/bin/ruby
# coding: utf-8

require 'bundler/setup'
Bundler.require

OPTDEL_LABEL = "delete"
OPTADD_LABEL = "add"
OPTUPD_LABEL = "update"
OPERATIONS = [ OPTDEL_LABEL, OPTADD_LABEL ]
KEY_LABEL = { "field" => { OPTDEL_LABEL => "delete-field",
                           OPTADD_LABEL => "add-field",
                           OPTUPD_LABEL => "replace-field" },
              "field-type" => { OPTDEL_LABEL => "delete-field-type",
                                OPTADD_LABEL => "add-field-type",
                                OPTUPD_LABEL => "replace-field-type" }
            }

SOLR_URL = "http://localhost:8983/solr/solrbook/schema"

operation = nil
if ARGV.length > 0 and OPERATIONS.include?(ARGV[0])
  operation = ARGV.shift
else
  exit 1
end

ARGV.each { |f|
  ret = {}
  json = nil
  open(f) {|data|
    json = JSON.load(data)
  }
  if json and json.keys.length == 1
    ## prepare variables
    data_type = json.keys[0] ## one of "field" or "field-type"
    key_name = KEY_LABEL[data_type][operation]
    ## setup the binary data
    if operation == OPTDEL_LABEL
      ret[key_name] = {}
      ret[key_name]["name"] = json[data_type]["name"]
    elsif operation == OPTADD_LABEL or operation == OPTUPD_LABEL
      ret[key_name] = json[data_type]
    end
  end
  puts ret
  client = HTTPClient.new
  resp = client.post(SOLR_URL, ret.to_json, "Content-Type" => "application/json")
  puts resp.body
}
```

æº–å‚™ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ©ç”¨ã—ã¦ã€solrã«schemaã‚’è¿½åŠ ã—ã¾ã™ã€‚

```bash
$ bundle config set path lib
$ bundle install
$ ./setup-solr-schema.rb add ft-ja_text_edgengram.json f-content_edgengram.json
```

### ã€æ–¹æ³•2ã€‘setup-solr-coreã‚’åˆ©ç”¨ã—ãŸcontent_edgengramãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¨­å®š

ä¸€é€£ã®ä½œæ¥­ã‚’ç°¡å˜ã«ã™ã‚‹ãŸã‚ã«ã€GitHubã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç™»éŒ²ã—ã¦ã„ã¾ã™ã€‚

* [GitHub - YasuhiroABE/setup-solr-core](https://github.com/YasuhiroABE/setup-solr-core)

setup-solr-coreã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€ft-ja_text_edgengram.json f-content_edgengram.json ã‚’åˆ©ç”¨ã—ã¦ã€æ¬¡ã®ã‚ˆã†æ“ä½œã—ã¾ã™ã€‚

```bash:setup-solr-coreã‚’åˆ©ç”¨ã—ãŸå ´åˆã®ä¾‹
$ git colone https://github.com/YasuhiroABE/setup-solr-core.git
$ cd setu-solr-core
$ make setup
$ mkdir -p setup-solrbook/{field,field-type}
$ cd setup-solrbook
$ cp ../examples/Makefile .
## catã‚³ãƒãƒ³ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚copy-and-pasteã®å¾Œã«C-dã§æŠœã‘ã‚‹ã‹ã€ä¸å¾—æ‰‹ãªã‚‰emacs,vimãªã©ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã“ã¨
$ cat > field-type/ft-ja_text_edgengram.json
$ cat > field/f-content_edgengram.json
$ make example-add
```

ã‚‚ã—ä»»æ„ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—ã‚„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ãŸã„ã®ã§ã‚ã‚Œã°ã€å®šç¾©ç”¨ã®jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸‹ã«é…ç½®ã—ã¦ã€å†åº¦ ``make example-add`` ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
å˜ç´”ãªå¤‰æ›´ã§ã‚ã‚Œã°ã€``make example-update`` ã§æ›´æ–°å‡¦ç†ãŒå¯èƒ½ã§ã™ã€‚

## Sinatraã‹ã‚‰Solrã«æ¥ç¶šã™ã‚‹

å†ã³ openapi-generator-cli ã§ç”Ÿæˆã—ãŸcodeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦ä½œæ¥­ã‚’é€²ã‚ã¾ã™ã€‚

```bash:setup-solr-core/setup-solrbook/ã«ã„ã‚‹å ´åˆã¯ã€../../codeã«ç½®ãæ›ãˆã‚‹ã“ã¨
$ cd code
```

code/lib/mysolr.rbã«solrã«æ¥ç¶šã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

```ruby:code/lib/mysolr.rb

# -*- coding:utf-8;mode:ruby -*-

class MySolr
  require 'rsolr'
  def initialize
    @solr_uri = ENV.has_key?("SOLR_URI") ? ENV["SOLR_URI"] : "http://127.0.0.1:8983/solr/solrbook"
  end
  
  def search(query)
    solr = RSolr.connect :url => @solr_uri
    ret = {}
    begin
      ret = solr.get 'select', :params => {
                            :q => query,
                            :wt => "json" ## never use the @param_wt, the @param_wt will effect output only.
                          }
    rescue => ex
      puts ex.to_s
    end
    return ret
  end

  def add(document, update = false)
    require 'rsolr'
    ret = {}
    solr = RSolr.connect :url => @solr_uri
    begin
      puts document
      if update
        ret = solr.update(document)
      else
        ret = solr.add(document)
      end
      solr.commit
      ret = true
    rescue => ex
      puts ex.to_s
    end
    return ret
  end
end
```

code/api/default_api.rbãƒ•ã‚¡ã‚¤ãƒ«ã«ä½œæˆã—ãŸMySolrã‚¯ãƒ©ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚
ä»Šåº¦ã¯ã€```MyApp.add_route('GET', '/dict', {...}) do```ã®å†…éƒ¨ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ruby:api/default_api.rbã®('GET','/dict')ã«è¿½åŠ ã—ãŸã‚³ãƒ¼ãƒ‰æŠœç²‹
  cross_origin
  param = {}
  param[:q] = params.has_key?(:q) ? Rack::Utils.escape_html(params[:q]) : ""
  
  solr = MySolr.new
  solr.search("id:#{param[:q]}").to_json
end 
```

åŒæ§˜ã«```MyApp.add_route('POST', '/dict', {...}) do```ã®å†…éƒ¨ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ruby:code/api/default_api.rbã®('POST','/dict')ã«è¿½åŠ ã—ãŸã‚³ãƒ¼ãƒ‰
  cross_origin
  ret = { :result => false }
  
  param = {}
  param[:ja] = params.has_key?(:ja) ? Rack::Utils.escape_html(params[:ja]) : ""
  param[:en] = params.has_key?(:en) ? Rack::Utils.escape_html(params[:en]) : ""

  solr = MySolr.new
  ret[:result]  = solr.add({ :id => param[:ja], :translation => param[:en],
                             :content_edgengram => param[:ja].to_s,
                             :updated => DateTime.now.iso8601 }, false)
end
```

# é…ç½®ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿

code/lib/mysolr.rb ã¨ code/lib/myutil.rb ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ã€requireæ–‡ãŒå¿…è¦ã§ã™ã€‚
code/config.ru ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¬¡ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```ruby:code/config.ruã®å…¨ä½“
require 'bundler/setup'
Bundler.require

require './lib/mysolr'
require './lib/myutil'
require './lib/dataapi'
require './lib/deeplapi'
require './lib/gct'

require './my_app'
run MyApp
```

ãªãŠGemfileã«è¨˜å…¥ã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯Bundler.requireãŒèª­ã¿è¾¼ã‚“ã§ãã‚Œã‚‹ã®ã§ã€default_api.rbãªã©ã«ã‚ã‚‹  ``require 'json'`` è¡Œã¯ã€å‰Šé™¤ã—ã¦ã‚‚å•é¡Œãªãå‹•ä½œã—ã¾ã™ã€‚

# ä½œæˆã—ãŸã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆ

code/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­ã§ã¯ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç”¨ã®ã‚¿ã‚¹ã‚¯ã‚‚Makefileã«ã¯è¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€example.rbã§ç’°å¢ƒå¤‰æ•° GOOGLE_APPLICATION_CREDENTIALS ã‚’åˆ©ç”¨ã—ãŸã‚ˆã†ã«ã€é©åˆ‡ã«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```bash:ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•(code/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œï¼‰
$ export GOOGLE_PROJECT_ID="your-project-id"
$ export GOOGLE_APPLICATION_CREDENTIALS="$(pwd)/xxxx.json"
$ export DEEPL_HOST="api.deepl.com"
$ export DEEPL_AUTHKEY="xxxx-xxxx-xxxx-xxxx"

$ make run

...
bundle exec rackup --host 0.0.0.0 --port 8080
Puma starting in single mode...
* Puma version: 5.2.2 (ruby 2.7.0-p0) ("Fettisdagsbulle")
*  Min threads: 0
*  Max threads: 5
*  Environment: development
*          PID: 14501
* Listening on http://0.0.0.0:8080
Use Ctrl-C to stop
```

ã‚‚ã—ãã¯ ``make run`` ã®å‰ã«ã€code/Makefile ã‚’ç·¨é›†ã—ã¦ã€runã‚¿ã‚¹ã‚¯ã«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚

```makefile:code/Makefileã¸ã®runã‚¿ã‚¹ã‚¯ã®è¿½åŠ 
run: bundle-install
	env GOOGLE_APPLICATION_CREDENTIALS="$$(pwd)/xxxx.json" \
	    GOOGLE_PROJECT_ID="xxxxxxxxx" \
	    DEEPL_HOST="api.deepl.com" \
	    DEEPL_AUTHKEY="xxxx-xxxx-xxxx-xxxx" \
		bundle exec rackup --host $(HOST) --port $(PORT)
```

## /trans APIã®ãƒ†ã‚¹ãƒˆ

curlã‚’åˆ©ç”¨ã—ã¦ã€â€ã¯ã˜ã‚ã¾ã—ã¦â€ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆã€æ¬¡ã®ã‚ˆã†ãªæ–¹æ³•ã§ãƒ†ã‚¹ãƒˆãŒå¯èƒ½ã§ã™ã€‚

```bash:curlã«ã‚ˆã‚‹/transã®ãƒ†ã‚¹ãƒˆ
$ curl --get --data-urlencode 'q="ã¯ã˜ã‚ã¾ã—ã¦"'  'http://localhost:8080/trans'

{"version":"1.0","results":[{"engine":"deepl","original_text":"&quot;ã¯ã˜ã‚ã¾ã—ã¦&quot;","translate_text":"","
to_lang":"en"},{"engine":"gct","original_text":"&quot;ã¯ã˜ã‚ã¾ã—ã¦&quot;","translate_text":"\"&quot;Nice to me
et you&quot;\"","to_lang":"en"}]}
```

curlã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€ãã®ã¾ã¾URLã§'http://localhost:8080/trans?q="ã¯ã˜ã‚ã¾ã—ã¦"'ã®ã‚ˆã†ãªæŒ‡å®šã‚’ã—ã¦ã‚‚ã€è‡ªå‹•ã§ã¯å¼•æ•°ã‚’URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãªã„ãŸã‚ã€ã“ã®ã‚ˆã†ãªæ–¹æ³•ã‚’å–ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã¡ãªã¿ã«ã€ã“ã®æ™‚ã®ã‚µãƒ¼ãƒãƒ¼å´ã®å‡ºåŠ›ã‚’ç¢ºèªã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```text:pumaã‚µãƒ¼ãƒãƒ¼ã®å‡ºåŠ›
127.0.0.1 - - [03/May/2021:23:57:08 +0900] "GET /trans?q=%22%E3%81%AF%E3%81%98%E3%82%81%E3%81%BE%E3%81%97%E3%81%A6%22 HTTP/1.1" 200 265 1.7633
```

## /dict APIã®ãƒ†ã‚¹ãƒˆ

/dictã«ã¯GETã¨POSTã®2ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
ã¾ãšå…ˆã»ã©æ¤œç´¢ã—ãŸçµæœã‚’ä¿å­˜ã™ã‚‹å ´åˆã€POSTãƒ¡ã‚½ãƒƒãƒ‰ã‚’çµŒç”±ã—ã¦ã€æ¬¡ã®ã‚ˆã†ãªæ–¹æ³•ã§curlã‚³ãƒãƒ³ãƒ‰ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚

```bash:curlã«ã‚ˆã‚‹/dictã¸ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç”Ÿæˆ
$ curl --data-urlencode "ja=ã¯ã˜ã‚ã¾ã—ã¦" --data-urlencode 'en="Nice to meet you"' 'http://localhost:8080/dict'
```

curlã¯--data-urlencodeãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯POSTãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç™ºè¡Œã™ã‚‹ãŸã‚ã€ç‰¹ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯æŒ‡å®šã—ã¦ã„ã¾ã›ã‚“ã€‚
æ¬¡ã«GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ä¿å­˜ã—ãŸçµæœã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash:curlã«ã‚ˆã‚‹/dictã¸ã®GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç”Ÿæˆ
$ curl --get --data-urlencode "q=ã¯ã˜ã‚ã¾ã—ã¦" 'http://localhost:8080/dict'

{"responseHeader":{"status":0,"QTime":1,"params":{"q":"id:ã¯ã˜ã‚ã¾ã—ã¦","wt":"json"}},"response":{"numFound":1
,"start":0,"numFoundExact":true,"docs":[{"id":"ã¯ã˜ã‚ã¾ã—ã¦","translation":["&quot;Nice to meet you&quot;"],"c
ontent_edgengram":["ã¯ã˜ã‚ã¾ã—ã¦"],"updated":["2021-05-03T15:06:10Z"],"_version_":1698750131859357696}]}}
```

ã“ã“ã¾ã§ã§ã€ã‚µãƒ¼ãƒãƒ¼å´ã®åŸºæœ¬çš„ãªå‹•ä½œã¯å®Œæˆã—ã¾ã—ãŸã€‚

## å®Œæˆã—ãŸã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã®ã‚µãƒ³ãƒ—ãƒ«

GitHubã«ã€ã“ã“ã¾ã§ã®ä½œæ¥­ã‚’çµ‚ãˆãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç™»éŒ²ã—ã¦ã„ã¾ã™ã€‚

* [GitHub - YasuhiroABE/docker-example-transapi](https://github.com/YasuhiroABE/docker-example-transapi)

æ¬¡ã®ã‚ˆã†ã«åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚

```bash:
$ git clone https://github.com/YasuhiroABE/docker-example-transapi.git
$ cd docker-example-transapi
$ make gen-code
$ cd code
## ç’°å¢ƒã«å¿œã˜ã¦é©åˆ‡ã«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹
$ export GOOGLE_APPLICATION_CREDENTIALS=/home/......./xxxx-xxxxxxxxx.json
$ export GOOGLE_PROJECT_ID="xxxxxxxxx"
$ export DEEPL_HOST="api.deepl.com"
$ export DEEPL_AUTHKEY="xxxx-xxxx-xxxx-xxxx"
$ make run
```

# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ

ä»Šå›ã¯Vue.jsã‚’åˆ©ç”¨ã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
vueã‚³ãƒãƒ³ãƒ‰(vue-cli)ã‚’åˆ©ç”¨ã—ã¦ã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

ã‚ã‚‰ã‹ã˜ã‚ã€nã‚³ãƒãƒ³ãƒ‰ã§LTSãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®node.jsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚
globalã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã®ã¯å¥½ãã§ã¯ãªã„ã®ã§ã€è‡ªåˆ†ã®ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã«é…ç½®ã—ã¾ã™ã€‚

```text:~/.npmrcãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹
prefix=/home/user01/.local
```

```bash:vueã‚³ãƒãƒ³ãƒ‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
$ npm install @vue/cli --user
```

~/.bashrcã«~/.local/bin/ã‚’PATHã«åŠ ãˆã¦ãŠãã¾ã™ã€‚

```bash:~/.bashrcã¸ã®è¿½è¨˜åˆ†
PATH="${PATH}:${HOME}/.local/bin"
export PATH
```

vueè‡ªä½“ã¯node.jsã‚’å‰æã¨ã¯ã—ã¦ã„ã¾ã›ã‚“ãŒã€ä»Šå›ã¯electronã«ã‚‚å±•é–‹ã™ã‚‹ã“ã¨ã‚’å¿µé ­ã«ä½œæ¥­ã‚’é€²ã‚ã¾ã™ã€‚

## å‚è€ƒè³‡æ–™

* https://qiita.com/quzq/items/608fa811f7ff2c1ae7f3

## æº–å‚™ä½œæ¥­

vue.jsã‚’è©¦ã™ãŸã‚ã«å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚
Webãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚‚electronã§ã‚‚å‹•ä½œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚

```bash:~/.local/bin/vueã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
$ vue create my-project
## ç”»é¢ã«Defaultã®é¸æŠè‚¢ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆã€Default ([Vue 2] babel, eslint) ã‚’é¸æŠã—ã¦ã„ã¾ã™ã€‚
ğŸ“„  Generating README.md...

ğŸ‰  Successfully created project my-project.
ğŸ‘‰  Get started with the following commands:

$ cd my-project
$ vue add electron-builder

## Choose Electron Version ã§ã¯ã€11.0.0ã‚’é¸æŠã—ã¦ã„ã¾ã™ã€‚
Run `npm audit` for details.
âš“  Running completion hooks...

âœ”  Successfully invoked generator for plugin: vue-cli-plugin-electron-builder
$ 
```

package.jsonã®"scripts"ã®å†…å®¹ã‚’ç¢ºèªã™ã‚‹ã¨ã€```$ npm run```ã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã«æ¸¡ã›ã‚‹ã‚¿ã‚¹ã‚¯ãŒæŒ‡å®šã§ãã¾ã™ã€‚

```bash:electronã®èµ·å‹•
$ npm run electron:serve
```

Webãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç¢ºèªã™ã‚‹ã«ã¯ã€```$ npm run serve```ã‚’å®Ÿè¡Œã—ã€http://localhost:8080/ãªã©ã®ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹URLã‚’é€šã—ã¦å‹•ä½œãŒç¢ºèªã§ãã¾ã™ã€‚

## ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹æˆ

ä½œæˆã—ãŸ"my-project"ä»¥ä¸‹ã«ã¯ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã©ãŒé…ç½®ã•ã‚Œã¾ã™ã€‚
```$ npm run electron:serve```ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€dist_electron/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«AppImageã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªãŒé…ç½®ã•ã‚Œã¾ã™ã€‚

ã“ã®å ´åˆã®Vue.jsã¯å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ§‹é€ ã‚’æŒã¤ã€template,script,styleãª.vueã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ©ç”¨ã‚’æ„è­˜ã—ãŸã‚‚ã®ã¨ãªã£ã¦ã„ã¾ã™ã€‚é–¢é€£ã®ã‚³ãƒ¼ãƒ‰ã¯ä¸»ã«public/ã¨src/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã•ã‚Œã¾ã™ã€‚

public/ã«ã¯Vueã®el:ã«æŒ‡å®šã™ã‚‹ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’æŒã¤ã‚ˆã†ãªé€šå¸¸ã®é™çš„ãªHTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒé…ç½®ã•ã‚Œã¦ã„ã¾ã™ã€‚

src/ã«ã¯.vueã‚µãƒƒãƒ•ã‚£ã‚¯ã‚¹ã‚’æŒã¤JavaScripté–¢é€£ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒé…ç½®ã•ã‚Œã¦ã„ã¾ã™ã€‚

è‡ªå‹•çš„ã«ã¯é…ç½®ã•ã‚Œã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€src/App.vueã‹ã‚‰src/components/HelloWorld.vueã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã®ã§ã€Vue.jsã®å‹•ãã‚’è¦³å¯Ÿã™ã‚‹ç›®çš„ã§ã‚‚è‰¯ã„ã‚µãƒ³ãƒ—ãƒ«ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

Vueã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æ•°ã ã‘ã€src/ç›´ä¸‹ã«.vueãƒ•ã‚¡ã‚¤ãƒ«ãŒé…ç½®ã•ã‚Œã€å„Vueã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§å†åˆ©ç”¨ã™ã‚‹ã‚ˆã†ãªUIéƒ¨åˆ†ã¯ã€src/components/ä»¥ä¸‹ã«é…ç½®ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

## APIã«æ¥ç¶šã™ã‚‹Vueã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

src/components/Translation.vue ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä¸€åˆ‡ã®å‡¦ç†ã¯ã“ã“ã«ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚
axiosã‚’åˆ©ç”¨ã—ã¦Web APIã‚’å©ã„ã¦ã„ã¾ã™ã®ã§ã€package.jsonãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯axiosã‚’dependenciesã«åŠ ãˆã¦ã„ã¾ã™ã€‚

```json:package.jsonã®å·®åˆ†
  },
  "main": "background.js",
  "dependencies": {
    "axios": "^0.21.4",
    "core-js": "^3.6.5",
    "vue": "^2.6.11"
  },
  "devDependencies": {
```

ã‚‚ã¡ã‚ã‚“axiosã‚’ ```npm install axios``` ã®ã‚ˆã†ã«åŠ ãˆã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```vue:src/components/Translation.vue
<template>
  <div class="translation">
    <a target="_blank" href="http://localhost:8983/">Open Solr Console</a>
    <br />
    <textarea class="input-ja" v-model="text_ja" @keydown.enter="search_api" placeholder="æ—¥æœ¬èª" />
    <textarea class="input-en" v-model="text_en" placeholder="English" />
    <br />
    <button class="button-search" type="button" v-on:click="exec_trans" >ç¿»è¨³é–‹å§‹</button>
    <button class="button-regist" v-on:click="exec_regist" type="button">æ‰‹å‹•ç™»éŒ²</button>
    <label>å†ç¿»è¨³</label>: <input v-model="is_exec_trans" type="checkbox" v-on:click="clicked_is_exec_trans" /> <p>{{ this.trans_warning }}</p>

    <h2>Ans. of {{ this.text_ja }}</h2>
    <table class="result">
    <thead>
    <tr>
      <th>No.</th>
      <th>æ—¥æœ¬èª</th>
      <th>English</th>
    </tr>
    </thead>
    <tbody>
    <tr v-for="(item, index) in info" :key="[item.id,item.translation]" @click="overwrite_jaen_input_field(item.id, item.translation[0])">
      <td>{{ index + 1 }}</td>
      <td>{{ item.id }}</td>
      <td>{{ item.translation[0] }}</td>
    </tr>
    </tbody>
    </table>

    <h2>Translation Result</h2>
    <table class="result">
    <thead>
    <tr>
      <th>No.</th>
      <th>Engine</th>
      <th>æ—¥æœ¬èª</th>
      <th>English</th>
    </tr>
    </thead>
    <tbody>
    <tr v-for="(item, index) in trans_result" :key="[item.engine,item.original_text,item.translate_text]" @click="overwrite_jaen_input_field(item.original_text, item.translate_text)">
      <td>{{ index + 1 }}</td>
      <td>{{ item.engine }}</td>
      <td>{{ item.original_text }}</td>
      <td>{{ item.translate_text }}</td>
    </tr>
    </tbody>
    </table>

    <h2>Registration Results</h2>
    <p>{{ results }}</p>

  </div>
</template>

<script>
/* from axios */
import axios from "axios"

export default {
  name: 'Translation',
  props: {
      text_ja: { type: String },
      text_en: { type: String },
      is_exec_trans: { type: Boolean },
      info: { type: String },
      results: { type: String }, 
      trans_result: { type: String },
      trans_warning: { type: String },
  },
  methods: {
    exec_regist() {
       axios
      .post("http://127.0.0.1:8080/dict?ja=" + this.text_ja + "&en=" + this.text_en, '')
      .then(response => (this.results = response));
    },
    exec_trans() {
      this.trans_warning = "";
      if(this.is_exec_trans) {
        axios
          .get("http://127.0.0.1:8080/trans?q=" + this.text_ja )
          .then(response => (this.trans_result = response.data.results));
        this.is_exec_trans = false;
      } else {
        this.trans_warning = "ç¿»è¨³æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹éš›ã¯ãƒã‚§ãƒƒã‚¯ã‚’ã‚ªãƒ³ã«ã—ã¦ãã ã•ã„ã€‚";
      }
    },
    search_api() {
      axios
      .get("http://127.0.0.1:8080/dict?q=" + this.text_ja )
      .then(response => (this.info = response.data.response.docs));
    },
    overwrite_jaen_input_field(ja_text, en_text) {
      this.text_ja = ja_text;
      this.text_en = en_text;
    },
    clicked_is_exec_trans() {
      this.trans_warning = "";
    },
  },
}
</script>

<style scoped lang="css">
.input-ja {
  margin: 0;
}

.input-en {
  margin: 0;
  margin: 0;
}

.button-search {
  background: #efeeff;
  margin: 1em;
}

.result {
  margin: 0 auto;
}
</style>
```

ä½œæˆã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’HelloWorldã®ä»£ã‚Šã«å‘¼ã³å‡ºã™ãŸã‚ã€src/App.vueãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚

```vue:src/App.vue
<template>
  <div id="app">
    <Translation />
  </div>
</template>

<script>
import Translation from './components/Translation.vue'

export default {
  name: 'App',
  components: {
    Translation
  }
}
</script>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
</style>
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èµ·å‹•

ä¸€éƒ¨ã®æ©Ÿèƒ½ã¯ã¾ã äºˆå®šã©ãŠã‚Šã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€æ—¥æœ¬èªã®DeepLã¨GCTã‚’åˆ©ç”¨ã—ãŸç¿»è¨³ã¨ã€çµæœã®Solrã¸ã®ç™»éŒ²ã«ã¤ã„ã¦ã¯

ã‚ã‚‰ã‹ã˜ã‚Solrã¨docker-example-transapiã‚’èµ·å‹•ã—ã¦ãŠãã¾ã™ã€‚docker-example-transapi/codeã«ç§»å‹•ã—ã¦``make solr-run``ã‚’å®Ÿè¡Œã™ã‚‹ã‹ã€æ¬¡ã®ã‚ˆã†ã«solrã‚’èµ·å‹•ã—ã€core/solrbook ã‚’ä½œæˆã—ã¦ãŠãã¾ã™ã€‚

```bash:solrã¨ã‚¢ãƒ—ãƒªã®èµ·å‹•
## solrã®èµ·å‹•
$ cd docker-example-transapi
$ make solr-run

## transapiã®èµ·å‹•
$ cd code
$ make run
```

solrãŒèµ·å‹•ã—ã¦å¿…è¦ãªcoreãŒèµ·å‹•ã—ã¦ã„ã‚Œã°ã€æ¬¡ã®è¦é ˜ã§ç¨¼å‹•ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash:vueãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èµ·å‹•
$ npm install
$ npm run serve
...
  App running at:
  - Local:   http://localhost:8081/
  - Network: http://192.168.85.129:8081/
```

ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ ```http://localhost:8081/``` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚

``npm run electron:serve`` ã‚’åˆ©ç”¨ã™ã‚Œã°ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ä»£ã‚Šã«electronãŒç«‹ã¡ä¸ŠãŒã‚ŠGUIã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## GitHubã‹ã‚‰ã®git clone

ã“ã“ã¾ã§ã®Vueã®ã‚³ãƒ¼ãƒ‰ã¯ã€GitHubä¸Šã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

* [GitHub - YasuhiroABE/docker-transapi-frontend](https://github.com/YasuhiroABE/docker-transapi-frontend)

# ã•ã„ã”ã«

Vueã‚’å§‹ã‚ã¦åˆ©ç”¨ã—ãŸã®ã§éœ²æ‰•ã„ã¨ã—ã¦ç°¡å˜ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚
ç¾åœ¨ã®DeepLã®Windowsã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯æ—¥æœ¬èªå…¥åŠ›æ™‚ã«ã€ã†ã¾ãæ–‡å­—ãŒå…¥åŠ›ã§ããªã„å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã®ã§ã€ã—ã°ã‚‰ãã“ã¡ã‚‰ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä¿®æ­£ã—ã¤ã¤åˆ©ç”¨ã—ã¦ã¿ã‚ˆã†ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

GCTã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãŸã‚‚ã®ã¯ã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³(")ãŒä»˜ããŸã‚ã€ä¿å­˜ã™ã‚‹éš›ã«å‰Šé™¤ã™ã‚‹ãªã©ã—ãªã„ã¨ã€&quote;ã®ã‚ˆã†ãªã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚ŒãŸæ–‡å­—åˆ—ãŒSolrã®æ¤œç´¢çµæœã«è¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

ã¾ã ã¾ã æ‹¡å¼µã¯å¿…è¦ã§ã™ãŒã€ã¨ã‚Šã‚ãˆãšè©¦ã›ã‚‹ã‚ˆã†ã«Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚„GitHubã§ã®ã‚³ãƒ¼ãƒ‰å…¬é–‹ãªã©ã‚’è¿½è¨˜ã—ã¾ã—ãŸã€‚

ä»¥ä¸Š

