---
title: VMware Workstation 16 Proã§vctl kindã‚’è©¦ã—ã¦ã¿ãŸ
tags:
  - vmware
  - kubernetes
private: false
updated_at: '2024-05-16T13:02:25+09:00'
id: 993a623c05d4dfe4d79c
organization_url_name: null
slide: false
ignorePublish: false
---
:::note
ä¸€å¿œvctl kindãŒåˆ©ç”¨ã§ãã‚‹ã¨ã„ã†ã®ã§è©¦ã—ã¦ã¿ã¾ã—ãŸãŒã€ã›ã£ã‹ãVMware Workstation Proã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã®ã§è¤‡æ•°VMã‚’ä½œæˆã—ã¦kubesprayã§æœ¬ç‰©ã®k8sã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹ãŒãƒ†ã‚¹ãƒˆç’°å¢ƒã¨ã—ã¦ã¯æ±ç”¨æ€§ãŒé«˜ã„ã¨æ€ã„ã¾ã™ã€‚

CustomControllerã®ä½œæˆã‚„Deployment, StatefulSetã®å­¦ç¿’ã«ã—ã¦ã‚‚rook.ioãªã©ã§StorageClassãŒæº–å‚™ã§ãã‚‹ç’°å¢ƒã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚
:::

# ã¯ã˜ã‚ã«

VMware Workstation 16 Pro/Playerã¯ã€kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’æ§‹ç¯‰ã§ãã‚‹ã¨å®£ä¼ã•ã‚Œã¦ã„ã¾ã™ã€‚
Fusion 12ã‚‚åŒæ§˜ã®æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã‚€ã—ã‚Fusion 12ã®ç›®ç‰æ©Ÿèƒ½ã¨ã—ã¦ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚µã‚¤ãƒˆã«æ²è¼‰ã•ã‚Œã¦ã„ã‚‹è¨˜äº‹ã‚‚ã‚ã‚‹ã®ã§ã€Workstaitonç‰ˆã§ã‚‚å‹•ãã¨ã¯ã™ãã«ã¯æ°—ãŒã¤ãã¾ã›ã‚“ã§ã—ãŸã€‚

VMwareã®å…¬å¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã¯ã€ä½•ã‚’ã—ãŸã‚‰è‰¯ã„ã‹åˆ†ã‹ã‚‰ãªã„åˆå¿ƒè€…ã«ã¯ååˆ†ã§ãªã„ã¨æ„Ÿã˜ãŸã®ã§ã€ãƒ¡ãƒ¢ã‚’æ®‹ã™ã“ã¨ã«ã—ã¾ã—ãŸã€‚

# ç’°å¢ƒ

* VMware Workstation 16.1 Pro
* ThinkPad T480 (i7-8550u, 32GB, 2TB NVMe SSD)

# å‚è€ƒè³‡æ–™

* [vmwareå…¬å¼ã‚¬ã‚¤ãƒ‰ - KIND ã‚’æœ‰åŠ¹ã«ã—ã¦ vctl ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒãƒ¼ãƒ‰ã¨ã—ã¦ä½¿ç”¨ã—ãŸ Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ã®å®Ÿè¡Œ](https://docs.vmware.com/jp/VMware-Workstation-Pro/16.0/com.vmware.ws.using.doc/GUID-1CA929BB-93A9-4F1C-A3A8-7A3A171FAC35.html)
* [VMware Fusion v12 â€“ Kubernetes / Kind integration](https://cormachogan.com/2020/09/17/vmware-fusion-v12-kubernetes-kind-integration/)

# å®Ÿéš›ã®ä½œæ¥­

ã¾ãšå…¬å¼ã‚¬ã‚¤ãƒ‰ã§ã¯ã€VMWareãƒ›ã‚¹ãƒˆã®PowerShellç­‰ç«¯æœ«ä¸Šã§vctlã‚’åˆ©ç”¨ã—ã¦æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«è¨˜è¿°ãŒã‚ã‚Šã¾ã™ã€‚

* vctl system start
* vctl kind

```powershell:ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
PS C:\Users\yasu> vctl system start
Preparing storage...
Container storage has been prepared successfully under C:\Users\yasu\.vctl\storage
Preparing container network...
Container network has been prepared successfully using vmnet: vmnet8
Launching container runtime...
Container runtime has been started.
PS C:\Users\yasu> vctl kind
```

ã“ã“ã¾ã§å®Ÿè¡Œã™ã‚‹ã¨åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒé–‹ãã¾ã™ãŒã€ã“ã“ã‹ã‚‰å…ˆã«ä½•ã‚’ã™ã‚Œã°è‰¯ã„ã®ã‹å…¬å¼ã‚¬ã‚¤ãƒ‰ã§ã¯ååˆ†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã®çŠ¶æ…‹ã§ã€kubectlã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã‚‚ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ãªã„ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```powershell:åˆ¥ã«é–‹ã„ãŸã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ä¸Šã§kubectlã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
PS C:\Users\yasu> kubectl get node
Unable to connect to the server: dial tcp [::1]:8080: connectex: No connection could be made because the target machine actively refused it.
```

æ¬¡ã«å‚è€ƒã«ã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯é€šå¸¸ã®kindã®åˆ©ç”¨æ–¹æ³•ã®ã‚ˆã†ã§ã™ã€‚kindé–¢é€£ã®æ–‡æ›¸ã§ã¯å›°ã£ãŸã‚‰logã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«ã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã®ç’°å¢ƒã§ã¯åˆ©ç”¨ã§ããªã„ã‚ˆã†ã§ã™ã€‚

```text:VMwareå…¬å¼ã‚¬ã‚¤ãƒ‰ã‹ã‚‰æŠœç²‹
vctl ã¯ kind build ãŠã‚ˆã³ kind export logs kind ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
```

ãŸã ã€å®Ÿéš›ã«export logsã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚

```powershell
PS C:\Users\yasu> kind export logs
Exported logs for cluster "kind" to:
C:\Users\yasu\AppData\Local\Temp\103590923

PS C:\Users\yasu> cd C:\Users\yasu\AppData\Local\Temp\103590923
PS C:\Users\yasu\AppData\Local\Temp\103590923\kind-control-plane> ls


    ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: C:\Users\yasu\AppData\Local\Temp\103590923\kind-control-plane


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        2020/11/23     19:55                containers
d-----        2020/11/23     19:55                pods
-a----        2020/11/23     19:55            375 alternatives.log
-a----        2020/11/23     19:55          30624 containerd.log
-a----        2020/11/23     19:55          12420 inspect.json
-a----        2020/11/23     19:55         165190 journal.log
-a----        2020/11/23     19:55         126832 kubelet.log
-a----        2020/11/23     19:55              7 kubernetes-version.txt
-a----        2020/11/23     19:55              0 serial.log
```

ã“ã‚ŒãŒæœŸå¾…ã¨é•ã†æŒ™å‹•ãªã®ã‹ä¸æ˜ã§ã™ãŒã€å¾Œã‹ã‚‰ãƒ­ã‚°ãŒå‡ºåŠ›ã§ãã‚‹ã“ã¨ã«æ°—ãŒã¤ã„ãŸã®ã§ã€ä»Šå›ã¯ã“ã®ãƒ­ã‚°ã¯å‚è€ƒã«ã—ã¾ã›ã‚“ã§ã—ãŸã€‚

kindã§ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ä½œæˆã™ã‚‹å‰ã«ã€æ­£å¸¸ç¨¼å‹•ã—ã¦ã„ãªã„å ´åˆã‚‚ã‚ã‚‹ã®ã§ã€å¿…ãšäº‹å‰ã«ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®æœ‰ç„¡ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚

```powershell:ã€ç¢ºèªã€‘ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å‰Šé™¤ã—ã¦ã‹ã‚‰ç¶šè¡Œ
PS C:\Users\yasu> kind get clusters
kind
PS C:\Users\yasu> kind delete cluster
Deleting cluster "kind" ...
```

```kind get clusters```ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒãªããªã£ã¦ã‹ã‚‰ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚

```powershell:é–‹ã„ãŸåˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‹ã‚‰ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ
PS C:\Users\yasu> kind get clusters
No kind clusters found.

PS C:\Users\yasu> kind create cluster
Creating cluster "kind" ...
 [32mâœ“[0m Ensuring node image (kindest/node:v1.19.1) ğŸ–¼
 [32mâœ“[0m Preparing nodes ğŸ“¦
 [32mâœ“[0m Writing configuration ğŸ“œ
 [32mâœ“[0m Starting control-plane ğŸ•¹ï¸
 [32mâœ“[0m Installing CNI ğŸ”Œ
 [32mâœ“[0m Installing StorageClass ğŸ’¾
Set kubectl context to "kind-kind"
You can now use your cluster with:

kubectl cluster-info --context kind-kind

Thanks for using kind! ğŸ˜Š
```

ã“ã“ã¾ã§æ¥ãŸã‚‰kubectlã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```powershell
PS C:\Users\yasu> kubectl cluster-info --context kind-kind
Kubernetes master is running at https://127.0.0.1:62402
KubeDNS is running at https://127.0.0.1:62402/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
```

ã¨ã‚Šã‚ãˆãškubeletãŒæ™®é€šã«å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```powershell:kubectlã®å®Ÿè¡Œä¾‹
PS C:\Users\yasu> kubectl get all --all-namespaces
NAMESPACE            NAME                                             READY   STATUS    RESTARTS   AGE
kube-system          pod/coredns-f9fd979d6-8wdwg                      1/1     Running   0          4m11s
kube-system          pod/coredns-f9fd979d6-w8ct6                      1/1     Running   0          4m11s
kube-system          pod/etcd-kind-control-plane                      1/1     Running   0          4m13s
kube-system          pod/kindnet-hmgtk                                1/1     Running   0          4m10s
kube-system          pod/kube-apiserver-kind-control-plane            1/1     Running   0          4m13s
kube-system          pod/kube-controller-manager-kind-control-plane   1/1     Running   0          4m13s
kube-system          pod/kube-proxy-tbcvt                             1/1     Running   0          4m11s
kube-system          pod/kube-scheduler-kind-control-plane            1/1     Running   0          4m13s
local-path-storage   pod/local-path-provisioner-78776bfc44-ll456      1/1     Running   0          4m4s

NAMESPACE     NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE
default       service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP                  4m28s
kube-system   service/kube-dns     ClusterIP   10.96.0.10   <none>        53/UDP,53/TCP,9153/TCP   4m21s

NAMESPACE     NAME                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
kube-system   daemonset.apps/kindnet      1         1         1       1            1           <none>                   4m11s
kube-system   daemonset.apps/kube-proxy   1         1         1       1            1           kubernetes.io/os=linux   4m20s

NAMESPACE            NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE
kube-system          deployment.apps/coredns                  2/2     2            2           4m21s
local-path-storage   deployment.apps/local-path-provisioner   1/1     1            1           4m4s

NAMESPACE            NAME                                                DESIRED   CURRENT   READY   AGE
kube-system          replicaset.apps/coredns-f9fd979d6                   2         2         2       4m11s
local-path-storage   replicaset.apps/local-path-provisioner-78776bfc44   1         1         1       4m4s
```

k8så…¬å¼ã‚¬ã‚¤ãƒ‰ã®YAMLã‚’åˆ©ç”¨ã—ã¦æŒ™å‹•ã‚’ç¢ºèªã—ã¾ã™ã€‚

* [Exposing an External IP Address to Access an Application in a Cluster](https://kubernetes.io/docs/tutorials/stateless-application/expose-external-ip-address/)

```powershell:ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®å®Ÿè¡Œ
PS C:\Users\yasu> kubectl apply -f https://k8s.io/examples/service/load-balancer-example.yaml
deployment.apps/hello-world created

PS C:\Users\yasu> kubectl get pod
NAME                           READY   STATUS              RESTARTS   AGE
hello-world-6df5659cb7-9m9kx   0/1     ContainerCreating   0          48s
hello-world-6df5659cb7-cr7k9   0/1     ContainerCreating   0          48s
hello-world-6df5659cb7-pdgxg   0/1     ContainerCreating   0          48s
hello-world-6df5659cb7-r8wsv   0/1     ContainerCreating   0          48s
hello-world-6df5659cb7-wn5hd   0/1     ContainerCreating   0          48s

PS C:\Users\yasu> kubectl expose deployment hello-world --type=LoadBalancer --name=my-service
service/my-service exposed

PS C:\Users\yasu> kubectl get svc
NAME         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
kubernetes   ClusterIP      10.96.0.1       <none>        443/TCP          95m
my-service   LoadBalancer   10.102.48.208   <pending>     8080:32715/TCP   14s
```

èª¿å­ã‚ˆãé€²ã‚“ã§ãã¾ã—ãŸãŒã€LoadBalancerã¯é…ç½®ã•ã‚Œã¦ã„ãªã„ã®ã§æ°¸ä¹…ã«External-IPã¯pendingçŠ¶æ…‹ã®ã¾ã¾ã¨ãªã‚Šã¾ã™ã€‚
ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦ç‰¹å®šã®Podã‚’æŒ‡å®šã—ã¦ã€127.0.0.1ã®ç‰¹å®šãƒãƒ¼ãƒˆã«ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```powershell:
PS C:\Users\yasu> kubectl expose deployment hello-world --type=NodePort  --name=my-service2
service/my-service2 exposed

PS C:\Users\yasu> kubectl port-forward svc/my-service2 9090:8080
Forwarding from 127.0.0.1:9090 -> 8080
Forwarding from [::1]:9090 -> 8080
Handling connection for 9090
```

ã¨ã‚Šã‚ãˆãšå‹•ãã¾ã—ãŸãŒã€æœ¬æ¥ã§ã‚ã‚Œã°kindæœ¬å®¶ã®ã‚¬ã‚¤ãƒ‰ã‚’èª­ã‚“ã§ã€ingress controllerã‚’é…ç½®ã™ã‚‹ã¹ããªã®ã ã¨æ€ã„ã¾ã™ã€‚
ãŸã ã€kindã‚’åˆ©ç”¨ã—ã¦æœ¬æ ¼çš„ãªç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ã®ã§ã‚ã‚Œã°ã€VMwareä¸Šã«3VMãã‚‰ã„ã‚’èµ·å‹•ã—ã¦ã€kubesprayã§full-specãªk8sã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’æ§‹ç¯‰ã—ã¦ã€MetalLBã§LoadBalancerã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

VMware Workstation Proã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šã¯å¼·åŠ›ã§ã€è‡ªåˆ†ç”¨ã«é–‰ã˜ãŸ10.1.1.0/24ã®ã‚ˆã†ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œã£ãŸã‚Šã™ã‚‹ã“ã¨ã¯ç°¡å˜ã«ã§ãã¾ã™ã€‚VMwareä¸Šã®kindã¯NATãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã™ã‚‹ã®ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šãªã®ã§ã€å…¬å¼ã‚¬ã‚¤ãƒ‰ã«ã‚ã‚‹ã‚ˆã†ã«è¨­å®šã‚’å¤‰æ›´ã™ã‚Œã°ã€åŒæ§˜ã«åˆ¥ã®VMNetã«æ¥ç¶šã§ãã‚‹ã®ã ã¨æ€ã„ã¾ã™ãŒã€ã„ã¾ã®ã¨ã“ã‚ã¯å€‹äººçš„ã«ã¯ç©æ¥µçš„ã«åˆ©ç”¨ã™ã‚‹ã¤ã‚‚ã‚Šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã“ã‚Œã¯å¾—æ„åˆ†é‡ãŒä½•ã«ã‚ã‚‹ã®ã‹ã«ä¾ã‚‹ã®ã‹ã¨ã¯æ€ã„ã¾ã™ãŒã€kindã®çµŒé¨“ãŒæœ¬ç•ªç’°å¢ƒã§ã‚‚æ´»ã‹ã›ã‚‹ã‹ã¨ã„ã†ã¨ã€æœ¬ç•ªã¨ã®å·®åˆ†ã‚’å¸åã™ã‚‹ãƒã‚¦ãƒã‚¦ã°ã‹ã‚ŠãŒè“„ç©ã•ã‚Œã‚‹ã‚ˆã†ãªå°è±¡ãŒå¼·ã„ã§ã™ã€‚ã“ã®è¦³ç‚¹ã§ã¯kindã®ã‚ˆã†ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ©ç”¨ã¯å€‹äººçš„ã«ã¯ã‚ã¾ã‚ŠãŠå‹§ã‚ã—ã¾ã›ã‚“ã€‚

ã¨ã¯ã„ãˆkubesprayã‚’æ¨ã—ã¦ã‚‚ã€ã“ã‚Œã¯ã“ã‚Œã§å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ãŸã æœ¬ç•ªç’°å¢ƒã¨ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’ã§ãã‚‹ã ã‘åŒã˜ã«ã—ãŸã„ã¨ã„ã†å°è¦æ¨¡ç’°å¢ƒã§ã‚ã‚Œã°ã€ç¾æ™‚ç‚¹ã§ã¯ãƒ™ã‚¹ãƒˆãªé¸æŠã¨æ€ã£ã¦ã„ã¾ã™ã€‚

# é­é‡ã—ãŸã‚¨ãƒ©ãƒ¼ã«ã¤ã„ã¦

æœ€åˆã«è©¦ã—ãŸæ™‚ã«ã¯ã€kindã§ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã¯ãšãªã®ã«ã€kubectlã‚³ãƒãƒ³ãƒ‰ã§ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

```powershell:åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ä¸Šã§kubectlã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
PS C:\Users\yasu> kubectl cluster-info --context kind-kind
To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
Unable to connect to the server: net/http: TLS handshake timeout
```

Docker Desktopã‚’å°å…¥ã—ã¦ã„ã‚‹ã®ã§ã€~/.kube/configãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯Kindã®åˆ†ãŒåŠ ã‚ã£ã¦2ã¤ã®contextãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

åˆ¥ã®Windowsãƒã‚·ãƒ³ä¸Šã§ã€VMware Workstation 16 Playerã‚’åˆ©ç”¨ã—ãŸé™ã‚Šã§ã¯ã€ã“ã®çŠ¶æ…‹ã§å•é¡Œãªãå‹•ã„ã¦ã„ã¾ã™ã€‚

æœ€çµ‚çš„ã«ã¯å†èµ·å‹•ã—ã€VMware Workstation 16 Proã¯èµ·å‹•ã›ãšã«PowerShellã®ç«¯æœ«ã‚’é–‹ãã€vctl system startã‹ã‚‰å†åº¦å®Ÿè¡Œã—ç„¡äº‹ã«èµ·å‹•ã—ã¾ã—ãŸã€‚


## é­é‡ã—ãŸã‚¨ãƒ©ãƒ¼ã«ã¤ã„ã¦ ver.2

å‰è¿°ã®ã‚¨ãƒ©ãƒ¼ã§ã„ã‚ã„ã‚è©¦ã—ã¦ã„ã‚‹æ®µéšã§ã€ã¾ãŸåˆ¥ã®ã‚¨ãƒ©ãƒ¼ã«é­é‡ã—ã¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒä½œæˆã§ããªããªã‚Šã¾ã—ãŸã€‚

```powershell
PS C:\Users\yasu> kind create cluster
Creating cluster "kind" ...
 [32mâœ“[0m Ensuring node image (kindest/node:v1.19.1) ğŸ–¼
 [31mâœ—[0m Preparing nodes ğŸ“¦
[31mERROR[0m: failed to create cluster: docker run error: command "docker run --hostname kind-control-plane --name kind-control-plane --label io.x-k8s.kind.role=control-plane --privileged --security-opt seccomp=unconfined --security-opt apparmor=unconfined --tmpfs /tmp --tmpfs /run --volume /var --volume /lib/modules:/lib/modules:ro --detach --tty --label io.x-k8s.kind.cluster=kind --net kind --restart=on-failure:1 --publish=127.0.0.1:63985:6443/TCP kindest/node:v1.19.1@sha256:98cf5288864662e37115e362b23e4369c8c4a408f99cbc06e58ac30ddc721600" failed with error: exit status 2
[31mCommand Output[0m: panic: runtime error: invalid memory address or nil pointer dereference
[signal 0xc0000005 code=0x0 addr=0x30 pc=0x10d59d2]

goroutine 1 [running]:
gitlab.eng.vmware.com/core-build/vctl/pkg/container.StartExistingContainer(0x159a860, 0xc00003e330, 0x0, 0x0, 0xc0002c4370, 0x1, 0x1, 0xc000046101, 0x1, 0xc00033b33d, ...)
        d:/build/ob/bora-17139912/kubernetesdesktop/build/release/win64_vc140/kubernetesdesktop/build/src/vctl/pkg/containerã¨/start.go:144 +0xd2
gitlab.eng.vmware.com/core-build/vctl/pkg/container.RunContainer(0x159a860, 0xc00003e330, 0xc0000363a0, 0x12, 0xc000046180, 0x5c, 0xc0002c4370, 0x1, 0x1, 0xc0001f2e40, ...)
        d:/build/ob/bora-17139912/kubernetesdesktop/build/release/win64_vc140/kubernetesdesktop/build/src/vctl/pkg/container/run.go:47 +0x375
gitlab.eng.vmware.com/core-build/vctl/cmd.glob..func28(0x1ebc3c0, 0xc00022a1c0, 0x1, 0x1c, 0x0, 0x0)
        d:/build/ob/bora-17139912/kubernetesdesktop/build/release/win64_vc140/kubernetesdesktop/build/src/vctl/cmd/run.go:59 +0x1b5
github.com/spf13/cobra.(*Command).execute(0x1ebc3c0, 0xc00022a000, 0x1c, 0x1c, 0x1ebc3c0, 0xc00022a000)
        d:/build/ob/bora-17139912/kubernetesdesktop/build/release/win64_vc140/kubernetesdesktop/build/pkg/mod/gitlab.eng.vmware.com/core-build/mirrors_github_spf13_cobra@v0.0.0-20200421035935-b81270fac540/command.go:827 +0x467
github.com/spf13/cobra.(*Command).ExecuteC(0x1ebfac0, 0x13adfa2, 0x10, 0x0)
        d:/build/ob/bora-17139912/kubernetesdesktop/build/release/win64_vc140/kubernetesdesktop/build/pkg/mod/gitlab.eng.vmware.com/core-build/mirrors_github_spf13_cobra@v0.0.0-20200421035935-b81270fac540/command.go:915 +0x30b
github.com/spf13/cobra.(*Command).Execute(...)
        d:/build/ob/bora-17139912/kubernetesdesktop/build/release/win64_vc140/kubernetesdesktop/build/pkg/mod/gitlab.eng.vmware.com/core-build/mirrors_github_spf13_cobra@v0.0.0-20200421035935-b81270fac540/command.go:865
gitlab.eng.vmware.com/core-build/vctl/cmd.Execute()
        d:/build/ob/bora-17139912/kubernetesdesktop/build/release/win64_vc140/kubernetesdesktop/build/src/vctl/cmd/root.go:55 +0x5d
main.main()
        d:/build/ob/bora-17139912/kubernetesdesktop/build/release/win64_vc140/kubernetesdesktop/build/src/vctl/main.go:13 +0x5e
```

ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¾ã™ã€‚

```powershell
PS C:\Users\yasu> vctl images
â”€â”€â”€â”€                                                                                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€ 
NAME                                                                                   CREATION TIME               SIZE 
â”€â”€â”€â”€                                                                                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€ 
nginx:latest                                                                           2020-11-23T11:44:30+09:00   51.1 MiB
kindest/node@sha256:98cf5288864662e37115e362b23e4369c8c4a408f99cbc06e58ac30ddc721600   2020-11-21T23:22:49+09:00   481.5 MiB
```

kindest/nodeã‚’å‰Šé™¤ã—ã¦ã¿ã¾ã™ã€‚

```powershell
PS C:\Users\yasu> vctl rmi kindest/node@sha256:98cf5288864662e37115e362b23e4369c8c4a408f99cbc06e58ac30ddc721600
â”€â”€â”€â”€                                                                                   â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€
NAME                                                                                   RESULT    REASON
â”€â”€â”€â”€                                                                                   â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€
kindest/node@sha256:98cf5288864662e37115e362b23e4369c8c4a408f99cbc06e58ac30ddc721600   REMOVED
```

ã“ã®çŠ¶æ…‹ã§2ã¤ç›®ã®powershellã‚’çµ‚äº†ã—ã€å†ã³ vctl system stop; vctl system start; vctl kindã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```powershell:æœ€åˆã®PowerShellã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã«æˆ»ã‚Šã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹
PS C:\Users\yasu> vctl system stop
Stop virtual machine kind-control-plane ...
Virtual machine kind-control-plane is stopped
Terminating container runtime...
æˆåŠŸ: PID 20444 ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯å¼·åˆ¶çµ‚äº†ã•ã‚Œã¾ã—ãŸã€‚
Container runtime has been stopped.
PS C:\Users\yasu> vctl system start
Preparing storage...
Container storage has been prepared successfully under C:\Users\yasu\.vctl\storage
Preparing container network...
Container network has been prepared successfully using vmnet: vmnet8
Launching container runtime...
Container runtime has been started.
PS C:\Users\yasu> vctl kind
```

å†ã³æ–°ãŸã«é–‹ã„ãŸPowerShellã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§kindã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã„ãã¾ã™ã€‚

```powershell:åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ä¸Šã§ã€kindã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ä½œæˆ
PS C:\Users\yasu> kind get clusters
No kind clusters found.
PS C:\Users\yasu> kind create cluster
Creating cluster "kind" ...
 [32mâœ“[0m Ensuring node image (kindest/node:v1.19.1) ğŸ–¼
 [32mâœ“[0m Preparing nodes ğŸ“¦
 [32mâœ“[0m Writing configuration ğŸ“œ
 [32mâœ“[0m Starting control-plane ğŸ•¹ï¸
 [32mâœ“[0m Installing CNI ğŸ”Œ
 [32mâœ“[0m Installing StorageClass ğŸ’¾
Set kubectl context to "kind-kind"
You can now use your cluster with:

kubectl cluster-info --context kind-kind

Thanks for using kind! ğŸ˜Š
```

ã“ã®çŠ¶æ…‹ã‹ã‚‰ã‚‚çµå±€ã¯ã†ã¾ãå‹•ãã¾ã›ã‚“ã§ã—ãŸãŒã€å†èµ·å‹•ã—ãŸã¨ã“ã‚å•é¡Œãªãç¨¼å‹•ã—ã¾ã—ãŸã€‚

# ã•ã„ã”ã«

kindã¯k8sç’°å¢ƒã«ãµã‚Œã‚‹ç›®çš„ã§ã¯ãŠæ‰‹è»½ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€VMwareã®Proç‰ˆã‚’ä½¿ãˆã°è¤‡æ•°ã®VMã‚’åˆ¥ã®ã‚µãƒ–ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã€kubesprayãªã©ã§æœ¬ç•ªã¨åŒç­‰ã®ç’°å¢ƒã‚’æ§‹ç¯‰ã—ãŸæ–¹ãŒä¾¿åˆ©ã ã¨æ€ã„ã¾ã™ã€‚

